<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RevisionGraph.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">r43ples</a> &gt; <a href="index.source.html" class="el_package">de.tud.plt.r43ples.existentobjects</a> &gt; <span class="el_source">RevisionGraph.java</span></div><h1>RevisionGraph.java</h1><pre class="source lang-java linenums">package de.tud.plt.r43ples.existentobjects;

import com.hp.hpl.jena.query.QuerySolution;
import com.hp.hpl.jena.query.ResultSet;
import de.tud.plt.r43ples.exception.InternalErrorException;
import de.tud.plt.r43ples.management.Config;
import de.tud.plt.r43ples.management.RevisionManagementOriginal;
import de.tud.plt.r43ples.triplestoreInterface.TripleStoreInterfaceSingleton;
import org.apache.log4j.Logger;

import java.util.ArrayList;

/**
 * The class RevisionGraph provides functionality for one named graph which is managed by R43ples
 * @author Markus Graube
 *
 */
public class RevisionGraph {

	/** The logger. **/
<span class="fc" id="L21">	private Logger logger = Logger.getLogger(RevisionManagementOriginal.class);</span>

	/** The URI of the named graph which R43ples manages. **/
	private String graphName;
	/** The revision graph URI. **/
	private String revisionGraphURI;

	/**
	 * Constructs a RevisionGraph for the specified graphName
	 *
	 * @param graphName URI of the named graph which R43ples manages
	 */
<span class="fc" id="L33">	public RevisionGraph(final String graphName) {</span>
<span class="fc" id="L34">		this.graphName = graphName;</span>
<span class="fc" id="L35">		this.revisionGraphURI = null;</span>
<span class="fc" id="L36">	}</span>

	/**
	 * Constructs a RevisionGraph for the specified graphName
	 *
	 * @param graphName URI of the named graph which R43ples manages
	 * @param revisionGraphURI the revision graph URI
	 */
<span class="fc" id="L44">	public RevisionGraph(final String graphName, final String revisionGraphURI) {</span>
<span class="fc" id="L45">		this.graphName = graphName;</span>
<span class="fc" id="L46">		this.revisionGraphURI = revisionGraphURI;</span>
<span class="fc" id="L47">	}</span>

	/**
	 * Get the graph name.
	 *
	 * @return the graph name
	 */
	public String getGraphName() {
<span class="fc" id="L55">		return graphName;</span>
	}

	/**
	 * Get the content of this revision graph by execution of CONSTRUCT.
	 *
	 * @param format RDF serialization format which should be returned
	 * @return the constructed graph content as specified RDF serialization format
	 */
	public String getContentOfRevisionGraph(final String format) {
<span class="fc" id="L65">		return RevisionManagementOriginal.getContentOfGraph(this.getRevisionGraphUri(), format);</span>
	}


	/** returns the name of the named graph which stores all revision information for the specified revised named graph
	 * 
	 * @return uri of the revision graph for this graph
	 */
	public String getRevisionGraphUri() {
<span class="fc bfc" id="L74" title="All 2 branches covered.">		if (revisionGraphURI == null) {</span>
<span class="fc" id="L75">			String query = String.format(</span>
					&quot;SELECT ?revisionGraph &quot;
							+ &quot;WHERE { GRAPH &lt;%s&gt; {&quot;
							+ &quot;	&lt;%s&gt; &lt;http://eatld.et.tu-dresden.de/rmo#hasRevisionGraph&gt; ?revisionGraph .&quot;
							+ &quot;} }&quot;, Config.revision_graph, graphName);

<span class="fc" id="L81">			ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>

<span class="fc bfc" id="L83" title="All 2 branches covered.">			if (results.hasNext()) {</span>
<span class="fc" id="L84">				QuerySolution qs = results.next();</span>
<span class="fc" id="L85">				revisionGraphURI = qs.getResource(&quot;?revisionGraph&quot;).toString();</span>
<span class="fc" id="L86">			} else {</span>
<span class="fc" id="L87">				return null;</span>
			}
		}

<span class="fc" id="L91">		return revisionGraphURI;</span>
	}

	/**
	 * Checks if the graph has a branch with the given identifier
	 * 
	 * @param identifier
	 *            revision number or branch or tag name of the graph
	 * @return true if specified revision of the graph is a branch
	 */
	public boolean hasBranch(final String identifier) {
<span class="fc" id="L102">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L103">		String queryASK = Config.prefixes</span>
				+ String.format(&quot;&quot;
						+ &quot;ASK { GRAPH &lt;%s&gt; { &quot; 
						+ &quot; ?rev a rmo:Revision. &quot;
						+ &quot; ?ref a rmo:Reference; rmo:references ?rev .&quot;
						+ &quot; { ?rev rmo:revisionNumber \&quot;%s\&quot;} UNION { ?ref rdfs:label \&quot;%s\&quot;} }} &quot;,
						revisionGraph, identifier, identifier);
<span class="fc" id="L110">		return TripleStoreInterfaceSingleton.get().executeAskQuery(queryASK);</span>
	}
	
	
	/**
	 * Check whether the revision graph has a reference with the specified name
	 * 
	 * @param referenceName
	 *            the branch name to check
	 * @return true when branch already exists elsewhere false
	 */
	public boolean hasReference(final String referenceName) {
<span class="fc" id="L122">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L123">		String queryASK = Config.prefixes</span>
				+ String.format(&quot;ASK { GRAPH &lt;%s&gt; { ?ref a rmo:Reference; rdfs:label \&quot;%s\&quot;.  }} &quot;,
						revisionGraph, referenceName);
<span class="fc" id="L126">		return TripleStoreInterfaceSingleton.get().executeAskQuery(queryASK);</span>
	}
	
	/**
	 * Get the graph URI containing the full copy of a reference for a given
	 * reference name or revision number
	 * 
	 * @param referenceIdentifier
	 *            reference name or revision number
	 * @return first graph name of full graph for specified reference and graph
	 * @throws InternalErrorException 
	 */
	public String getReferenceGraph(final String referenceIdentifier) throws InternalErrorException {
<span class="fc" id="L139">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L140">		String query = Config.prefixes + String.format(&quot;&quot; </span>
				+ &quot;SELECT ?graph &quot; 
				+ &quot;WHERE { GRAPH  &lt;%s&gt; {&quot; 
				+ &quot;	?ref a rmo:Reference; &quot;
				+ &quot;		rmo:references ?rev;&quot; 
				+ &quot;		rmo:fullGraph ?graph.&quot;
				+ &quot; ?rev a rmo:Revision.&quot;
				+ &quot;	{?ref rdfs:label \&quot;%s\&quot;} UNION {?rev rmo:revisionNumber \&quot;%s\&quot;}&quot; 
				+ &quot;} }&quot;, revisionGraph, referenceIdentifier, referenceIdentifier);
<span class="fc" id="L149">		this.logger.debug(query);</span>
<span class="fc" id="L150">		ResultSet resultSet = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">		if (resultSet.hasNext()) {</span>
<span class="fc" id="L152">			QuerySolution qs = resultSet.next();</span>
<span class="fc" id="L153">			return qs.getResource(&quot;?graph&quot;).toString();</span>
		} else {
<span class="nc" id="L155">			throw new InternalErrorException(&quot;No reference graph found for graph &lt;&quot;+graphName+&quot;&gt; and identifier \&quot;&quot;+ referenceIdentifier+&quot;\&quot;&quot;);</span>
		}
	}
	
	/**
	 * Get the MASTER revision of this revision graph.
	 *
	 * @return the MASTER revision
	 * @throws InternalErrorException
	 */
	public Revision getMasterRevision() throws InternalErrorException{
<span class="fc" id="L166">        logger.info(&quot;Get MASTER revision of graph &quot; + graphName);</span>

<span class="fc" id="L168">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L169">		String queryString = Config.prefixes + String.format(&quot;&quot;</span>
				+ &quot;SELECT ?revisionNumber &quot;
				+ &quot;WHERE { GRAPH &lt;%s&gt; {&quot;
				+ &quot;	?master a rmo:Master; rmo:references ?revision . &quot;
				+ &quot; ?revision rmo:revisionNumber ?revisionNumber .&quot;
				+ &quot;} }&quot;, revisionGraph);
<span class="fc" id="L175">		ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(queryString);</span>
<span class="pc bpc" id="L176" title="1 of 2 branches missed.">		if (results.hasNext()){</span>
<span class="fc" id="L177">			QuerySolution qs = results.next();</span>
<span class="fc" id="L178">			return this.getRevision(qs.getLiteral(&quot;?revisionNumber&quot;).toString());</span>
		}
		else {
<span class="nc" id="L181">            throw new InternalErrorException(&quot;No master for graph &lt;&quot; + this.graphName + &quot;&gt; available&quot;);</span>
        }
	}
	
	/**
	 * Returns new unique revision identifier for this graph.
	 *
	 * @return new revision identifier
	 * @throws InternalErrorException 
	 */
	public String getNextRevisionIdentifier() throws InternalErrorException {
		//
		int nextNumber;
		
<span class="fc" id="L195">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L196">		String query = Config.prefixes</span>
				+ String.format(
					&quot;SELECT ?nr &quot;
					+ &quot;WHERE { GRAPH &lt;%s&gt; {&quot;
					+ &quot;	?rev a rmo:Revision; rmo:revisionNumber ?nr .&quot;
					+ &quot; } &quot;
					+ &quot;}ORDER BY DESC(xsd:integer(?nr))&quot;, revisionGraph);
		try {
<span class="fc" id="L204">			ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="fc" id="L205">			QuerySolution qs = results.next();</span>
<span class="fc" id="L206">			nextNumber = qs.getLiteral(&quot;?nr&quot;).getInt()+1;</span>
		}
<span class="fc" id="L208">		catch (Exception e){</span>
<span class="fc" id="L209">			nextNumber = 0;</span>
<span class="fc" id="L210">		}</span>
		
<span class="fc" id="L212">		int count = 0;</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">		while (this.hasRevisionNumber(&quot;&quot;+nextNumber)){</span>
<span class="nc" id="L214">			nextNumber++;</span>
<span class="nc" id="L215">			count++;</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">			if (count==100)</span>
<span class="nc" id="L217">				throw new InternalErrorException(&quot;No new revision number found&quot;);</span>
		}
		
<span class="fc" id="L220">		return &quot;&quot;+nextNumber;</span>
	}
	
	/**
	 * Deletes all revision information for this revision graph including all full
	 * graphs and information in the R43ples system.
	 * 
	 */
	public void purgeRevisionInformation() {
<span class="fc" id="L229">		logger.info(&quot;Purge revision information of graph &quot; + graphName);</span>
		// Drop all full graphs as well as add and delete sets which are related
		// to specified graph
<span class="fc" id="L232">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L233">		String query = Config.prefixes	+ String.format(&quot;&quot;</span>
				+ &quot;SELECT DISTINCT ?graph &quot;
				+ &quot;WHERE { GRAPH &lt;%s&gt; {&quot;
				+ &quot; {?rev rmo:addSet ?graph}&quot; 
				+ &quot; UNION {?rev rmo:deleteSet ?graph}&quot;
				+ &quot; UNION {?ref rmo:fullGraph ?graph}&quot;
				+ &quot;} }&quot;, revisionGraph);
				
<span class="fc" id="L241">		ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="fc bfc" id="L242" title="All 2 branches covered.">		while (results.hasNext()) {</span>
<span class="fc" id="L243">			QuerySolution qs = results.next();</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">			if (qs.get(&quot;?graph&quot;).isResource()) {</span>
<span class="fc" id="L245">					String graph = qs.getResource(&quot;graph&quot;).toString();</span>
<span class="fc" id="L246">					TripleStoreInterfaceSingleton.get().executeUpdateQuery(&quot;DROP SILENT GRAPH &lt;&quot; + graph + &quot;&gt;&quot;);</span>
<span class="fc" id="L247">					logger.debug(&quot;Graph deleted: &quot; + graph);</span>
			}
<span class="fc" id="L249">		}</span>
<span class="fc" id="L250">		TripleStoreInterfaceSingleton.get().executeUpdateQuery(String.format(&quot;DROP SILENT GRAPH &lt;%s&gt;&quot;, revisionGraph));</span>
		
		// Remove information from revision graph
<span class="fc" id="L253">		String queryDelete = Config.prefixes + String.format(</span>
					   	&quot;DELETE { &quot;
						+ &quot;GRAPH &lt;%s&gt; {	&lt;%s&gt; ?p ?o.}&quot;
						+ &quot;}&quot; 
						+ &quot;WHERE {&quot;
						+ &quot;	GRAPH &lt;%s&gt; { &lt;%s&gt; a rmo:Graph; ?p ?o.}&quot; 
						+ &quot;}&quot;
						, Config.revision_graph, graphName, Config.revision_graph, graphName);
		
<span class="fc" id="L262">		TripleStoreInterfaceSingleton.get().executeUpdateQuery(queryDelete);</span>
<span class="fc" id="L263">	}</span>
	
	/**
	 * get the names of all branches of the revision graph
	 * @return list of the name of branch
	 * */
	public ArrayList&lt;String&gt; getAllBranchNames() {
<span class="nc" id="L270">		logger.info(&quot;Get all branch names of graph &quot;+ graphName);</span>
<span class="nc" id="L271">		ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();	</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">		if (graphName != null) {</span>
<span class="nc" id="L273">			String revisionGraph = this.getRevisionGraphUri();</span>
<span class="nc" id="L274">			String sparqlQuery = Config.prefixes</span>
					+ String.format(
					  &quot;SELECT DISTINCT ?label %n&quot;
					+ &quot;FROM &lt;%s&gt; %n&quot;
					+ &quot;WHERE { %n&quot;
					+ &quot;	?branch a rmo:Branch ;&quot;
					+ &quot;		rdfs:label ?label . &quot;
					+ &quot;} %n&quot;
					+ &quot;ORDER BY ?label&quot;, revisionGraph);
			
<span class="nc" id="L284">			ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(sparqlQuery);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">			while (results.hasNext()) {</span>
<span class="nc" id="L286">				QuerySolution qs = results.next();</span>
<span class="nc" id="L287">				list.add(qs.getLiteral(&quot;label&quot;).toString());</span>
<span class="nc" id="L288">			}		</span>
		}
<span class="nc" id="L290">		logger.debug(&quot;All branches: &quot; +list);</span>
<span class="nc" id="L291">		return list;</span>
	}
	
	
	/**
	 * Get the reference URI of a branch for a given reference name or revision number
	 * 
	 * @param referenceIdentifier
	 *            reference name or revision number
	 * @return URI of identified revision
	 * @throws InternalErrorException 
	 */
	public String getBranchUri(final String referenceIdentifier) throws InternalErrorException {
<span class="fc" id="L304">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L305">		String query = Config.prefixes</span>
				+ String.format(&quot;SELECT ?ref &quot; 
						+ &quot;WHERE { GRAPH &lt;%s&gt; {&quot;
						+ &quot;	?ref a rmo:Branch; rmo:references ?rev.&quot;
						+ &quot; ?rev a rmo:Revision.&quot;
						+ &quot;	{?rev rmo:revisionNumber \&quot;%s\&quot;.} UNION {?ref rdfs:label \&quot;%s\&quot; .}&quot;
						+ &quot;} }&quot;,
						revisionGraph, referenceIdentifier, referenceIdentifier);
<span class="fc" id="L313">		ResultSet resultSet = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">		if (resultSet.hasNext()) {</span>
<span class="fc" id="L315">			QuerySolution qs = resultSet.next();</span>
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">			if (resultSet.hasNext()) {</span>
<span class="nc" id="L317">				throw new InternalErrorException(&quot;Identifier is not unique for specified graph name: &quot;</span>
						+ referenceIdentifier);
			}
<span class="fc" id="L320">			return qs.getResource(&quot;?ref&quot;).toString();</span>
		} else {
<span class="nc" id="L322">			throw new InternalErrorException(&quot;No Revision or Reference found with identifier: &quot;</span>
					+ referenceIdentifier);
		}
	}

	/**
	 * Get the revision object for a given reference name or revision number
	 *
	 * @param branchInformation the branch information (identifier or URI of the branch)
	 * @param isIdentifier identifies if the identifier or the URI of the branch is specified (identifier =&gt; true; URI =&gt; false)
	 * @return Branch object
	 * @throws InternalErrorException
	 */
	public Branch getBranch(final String branchInformation, final boolean isIdentifier) throws InternalErrorException {
<span class="fc" id="L336">		return new Branch(this, branchInformation, isIdentifier);</span>
	}

	/**
	 * Get the revision URI for a given reference name or revision number
	 * 
	 * @param revisionIdentifier
	 *            reference name or revision number
	 * @return URI of identified revision
	 * @throws InternalErrorException 
	 */
	public String getRevisionUri(final String revisionIdentifier) throws InternalErrorException {
<span class="fc" id="L348">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L349">		String query = Config.prefixes</span>
				+ String.format(
						&quot;SELECT ?rev WHERE { GRAPH &lt;%s&gt; {&quot;
							+ &quot;{?rev a rmo:Revision; rmo:revisionNumber \&quot;%s\&quot; .}&quot;
							+ &quot;UNION {?rev a rmo:Revision. ?ref a rmo:Reference; rmo:references ?rev; rdfs:label \&quot;%s\&quot; .}&quot;
							+ &quot;} }&quot;, revisionGraph, revisionIdentifier, revisionIdentifier);
<span class="fc" id="L355">		ResultSet resultSet = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">		if (resultSet.hasNext()) {</span>
<span class="fc" id="L357">			QuerySolution qs = resultSet.next();</span>
<span class="pc bpc" id="L358" title="1 of 2 branches missed.">			if (resultSet.hasNext()) {</span>
<span class="nc" id="L359">				logger.error(&quot;Identifier not unique: &quot; + revisionIdentifier);</span>
<span class="nc" id="L360">				throw new InternalErrorException(&quot;Identifier not unique: &quot; + revisionIdentifier);</span>
			}
<span class="fc" id="L362">			return qs.getResource(&quot;?rev&quot;).toString();</span>
		} else {
<span class="nc" id="L364">			logger.error(&quot;No Revision or Reference found with identifier: &quot; + revisionIdentifier);</span>
<span class="nc" id="L365">			throw new InternalErrorException(&quot;No Revision or Reference found with identifier: &quot;</span>
					+ revisionIdentifier);
		}
	}


	/**
	 * Get the revision object for a given reference name or revision number
	 *
	 * @param revisionIdentifier
	 *            reference name or revision number
	 * @return Revision object
	 * @throws InternalErrorException
	 */
	public Revision getRevision(final String revisionIdentifier) throws InternalErrorException {
<span class="fc" id="L380">		return new Revision(this, getRevisionUri(revisionIdentifier), false);</span>
	}



	/**
	 * Get the revision identifier while it is not necessary to know if the specified identifier parameter is a reference or the resulting revision identifier itself.
	 *
	 * @param identifier the identifier to look for (referenc or revision identifier itself)
	 * @return the revision identifier
	 * @throws InternalErrorException 
	 */
	public String getRevisionIdentifier(final String identifier) throws InternalErrorException {
<span class="fc" id="L393">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L394">		String query = Config.prefixes + String.format(&quot;&quot;</span>
				+ &quot;SELECT ?revNumber WHERE { GRAPH &lt;%s&gt; {&quot;
				+ &quot;	?rev a rmo:Revision; rmo:revisionNumber ?revNumber.&quot;
				+ &quot;	{?rev rmo:revisionNumber \&quot;%s\&quot;.} UNION {?ref a rmo:Reference; rmo:references ?rev; rdfs:label \&quot;%s\&quot;.}&quot;
				+ &quot;} }&quot;, 
				revisionGraph, identifier, identifier);
<span class="fc" id="L400">		ResultSet resultSet = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">		if (resultSet.hasNext()) {</span>
<span class="fc" id="L402">			QuerySolution qs = resultSet.next();</span>
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">			if (resultSet.hasNext()) {</span>
<span class="nc" id="L404">				throw new InternalErrorException(&quot;Identifier not unique: &quot; + identifier);</span>
			}
<span class="fc" id="L406">			return qs.getLiteral(&quot;?revNumber&quot;).toString();</span>
		} else {
<span class="nc" id="L408">			throw new InternalErrorException(&quot;No Revision or Reference found with identifier: &quot;</span>
					+ identifier);
		}
	}

		
	/**
	 * checks whether the revision number already exist
	 * @param revisionNumber
	 * @return boolean*/

	private boolean hasRevisionNumber(final String revisionNumber) {
<span class="fc" id="L420">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L421">		String queryASK = Config.prefixes</span>
				+ String.format(&quot;&quot;
						+ &quot;ASK {&quot;
						+ &quot;	GRAPH &lt;%1$s&gt; { &quot; 
						+ &quot; 	{ ?rev a rmo:Revision; rmo:revisionNumber \&quot;%2$s\&quot;. }&quot;
						+ &quot;		UNION &quot;
						+ &quot;		{?rev a rmo:Revision. ?ref a rmo:Reference; rmo:references ?rev; rdfs:label \&quot;%2$s\&quot; .}&quot;
						+ &quot;} } &quot;,
						revisionGraph, revisionNumber);
<span class="fc" id="L430">		return TripleStoreInterfaceSingleton.get().executeAskQuery(queryASK);</span>
	}
	
	/**
	 * Get the URI of the full graph of the specified branch if it exists. Otherwise return null

	 * @param branchURI
	 * @return URI of the full graph
	 */
	public String getFullGraphUri(final String branchURI) {
<span class="fc" id="L440">		String revisionGraph = this.getRevisionGraphUri();</span>
<span class="fc" id="L441">		String query = String.format(</span>
				  &quot;SELECT ?fullGraphURI %n&quot;
			    + &quot;WHERE { GRAPH &lt;%s&gt; {%n&quot;
				+ &quot;	&lt;%s&gt; &lt;http://eatld.et.tu-dresden.de/rmo#fullGraph&gt; ?fullGraphURI . %n&quot;
				+ &quot;} }&quot;, revisionGraph, branchURI);
			
<span class="fc" id="L447">		ResultSet results = TripleStoreInterfaceSingleton.get().executeSelectQuery(query);</span>
		
<span class="pc bpc" id="L449" title="1 of 2 branches missed.">		if (results.hasNext()) {</span>
<span class="fc" id="L450">			QuerySolution qs = results.next();</span>
<span class="fc" id="L451">			return qs.getResource(&quot;?fullGraphURI&quot;).toString();</span>
		} else {
<span class="nc" id="L453">			return null;</span>
		}
	}
	
	
	/** Get SDD for this named graph
	 * 
	 * @param sdd
	 * @return specified SDD if not null otherwise the default SDD for the specified graph
	 * @throws InternalErrorException
	 */
	public String getSDD(String sdd)
			throws InternalErrorException {
<span class="pc bpc" id="L466" title="2 of 4 branches missed.">		if (sdd != null &amp;&amp; !sdd.equals(&quot;&quot;)) {</span>
<span class="fc" id="L467">			return sdd;</span>
		} else {
			// Default SDD
			// Query the referenced SDD
<span class="nc" id="L471">			String querySDD = String.format(</span>
					  &quot;PREFIX sddo: &lt;http://eatld.et.tu-dresden.de/sddo#&gt; %n&quot;
					+ &quot;PREFIX rmo: &lt;http://eatld.et.tu-dresden.de/rmo#&gt; %n&quot;
					+ &quot;SELECT ?defaultSDD %n&quot;
					+ &quot;WHERE { GRAPH &lt;%s&gt; {	%n&quot;
					+ &quot;	&lt;%s&gt; a rmo:Graph ;%n&quot;
					+ &quot;		sddo:hasDefaultSDD ?defaultSDD . %n&quot;
					+ &quot;} }&quot;, Config.revision_graph, this.graphName);
			
<span class="nc" id="L480">			ResultSet resultSetSDD = TripleStoreInterfaceSingleton.get().executeSelectQuery(querySDD);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">			if (resultSetSDD.hasNext()) {</span>
<span class="nc" id="L482">				QuerySolution qs = resultSetSDD.next();</span>
<span class="nc" id="L483">				return qs.getResource(&quot;?defaultSDD&quot;).toString();</span>
			} else {
<span class="nc" id="L485">				throw new InternalErrorException(&quot;Error in revision graph! Selected graph &lt;&quot; + this.graphName + &quot;&gt; has no default SDD referenced.&quot;);</span>
			}
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>